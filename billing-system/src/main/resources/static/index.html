<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Pahana Edu Bookshop</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
            transition: background-color 0.3s ease;
        }
        /* Default (Blue) Theme */
        :root {
            --primary-color: #1a73e8;
            --primary-light: #4c8be8;
            --accent-color: #38a169;
            --text-color: #2d3748;
            --header-bg: #ffffff;
            --nav-bg: #1a73e8;
        }
        /* Green Theme */
        .theme-green {
            --primary-color: #38a169;
            --primary-light: #48bb78;
            --accent-color: #f6ad55;
            --text-color: #2d3748;
            --header-bg: #f0fdf4;
            --nav-bg: #38a100;
        }
        .text-primary {
            color: var(--primary-color);
        }
        .bg-primary {
            background-color: var(--primary-color);
        }
        .bg-primary-light {
            background-color: var(--primary-light);
        }
        .text-accent {
            color: var(--accent-color);
        }
        .bg-accent {
            background-color: var(--accent-color);
        }
        .bg-header {
            background-color: var(--header-bg);
        }
        .bg-nav {
            background-color: var(--nav-bg);
        }
        .transition-colors {
            transition: color 0.3s ease, background-color 0.3s ease;
        }
    </style>
</head>
<body class="antialiased text-gray-800">

<!-- Main container -->
<div class="antialiased text-gray-800">
    <!-- Top Header -->
    <header class="bg-header shadow-sm transition-colors">
        <div class="container mx-auto px-4 py-2 flex flex-col md:flex-row justify-between items-center text-sm">
            <div class="flex items-center space-x-4 mb-2 md:mb-0 text-gray-600">
                <span>Web Orders: +94 711304050</span>
                <span>Email: info@Pahanaedubookshop.lk</span>
            </div>
            <div class="flex items-center space-x-4">
                <a href="#" class="text-gray-600 hover:text-primary transition-colors">Advanced Search</a>
                <a href="/UserLogin.html" class="text-gray-600 hover:text-primary transition-colors">User Login</a>
                <a href="AdminLogin.html" class="text-gray-600 hover:text-primary transition-colors">Admin Login</a>
                <a href="/UserDashboard.html" class="text-gray-600 hover:text-primary transition-colors">My Account</a>
                <a href="/help.html" class="text-gray-600 hover:text-primary transition-colors">Help</a>
                <button onclick="logout()" class="text-gray-600 hover:text-primary transition-colors">Exit</button>
            </div>
        </div>
    </header>

    <!-- Main Navigation Bar -->
    <nav class="bg-nav shadow-lg transition-colors">
        <div class="container mx-auto px-4 py-4 flex items-center justify-between">
            <!-- Logo -->
            <a href="/" class="text-white text-2xl font-bold">Pahana Edu Bookshop</a>
            <!-- Main Nav Links -->
            <ul class="hidden md:flex space-x-6 text-white font-medium">
                <li><a href="/category/latest-arrivals.html" class="hover:underline">Latest Arrivals</a></li>
                <li><a href="/category/childrens-books.html" class="hover:underline">Children's Books</a></li>
                <li><a href="/category/fiction.html" class="hover:underline">Fiction</a></li>
                <li><a href="/category/international-books.html" class="hover:underline">International Books</a></li>
                <li><a href="/category/e-books.html" class="hover:underline">E-Books</a></li>
                <li><a href="/branches.html" class="hover:underline">Branches</a></li>
            </ul>

            <!-- Cart Button with item count badge -->
            <div class="relative ml-6">
                <button id="cart-button" aria-label="View Cart" class="text-white hover:text-gray-300 focus:outline-none focus:ring-2 focus:ring-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4"></path>
                        <circle cx="7" cy="21" r="1"></circle>
                        <circle cx="17" cy="21" r="1"></circle>
                    </svg>
                    <span id="cart-count" class="absolute top-0 right-0 -mt-1 -mr-2 bg-red-600 text-white rounded-full text-xs w-5 h-5 flex items-center justify-center">0</span>
                </button>
            </div>

            <!-- Mobile Menu Button -->
            <button id="mobile-menu-btn" class="md:hidden text-white focus:outline-none" aria-label="Open mobile menu">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
                </svg>
            </button>
        </div>
    </nav>

    <!-- Mobile Menu (Hidden by default) -->
    <div id="mobile-menu" class="hidden md:hidden bg-nav text-white px-4 py-2 transition-colors">
        <ul class="flex flex-col space-y-2 font-medium">
            <li><a href="/category/latest-arrivals.html" class="block hover:bg-primary-light px-2 py-1 rounded transition-colors">Latest Arrivals</a></li>
            <li><a href="/category/childrens-books.html" class="block hover:bg-primary-light px-2 py-1 rounded transition-colors">Children's Books</a></li>
            <li><a href="/category/fiction.html" class="block hover:bg-primary-light px-2 py-1 rounded transition-colors">Fiction</a></li>
            <li><a href="/category/international-books.html" class="block hover:bg-primary-light px-2 py-1 rounded transition-colors">International Books</a></li>
            <li><a href="/category/e-books.html" class="block hover:bg-primary-light px-2 py-1 rounded transition-colors">E-Books</a></li>
            <li><a href="/branches.html" class="block hover:bg-primary-light px-2 py-1 rounded transition-colors">Branches</a></li>
        </ul>
    </div>

    <!-- Theme Switcher and Refresh -->
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
        <div class="flex space-x-2">
            <button id="refresh-btn" class="bg-gray-200 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-300 transition-colors">Refresh Content</button>
            <button id="reset-banner-btn" class="bg-gray-200 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-300 transition-colors">Reset Banner</button>
        </div>
        <div class="flex items-center space-x-2">
            <span class="text-gray-600 text-sm">Themes:</span>
            <button id="theme-blue-btn" class="w-8 h-8 rounded-full bg-primary transition-colors border-2 border-transparent focus:border-gray-500" aria-label="Switch to blue theme" title="Switch to blue theme"></button>
            <button id="theme-green-btn" class="w-8 h-8 rounded-full bg-green-500 transition-colors border-2 border-transparent focus:border-gray-500" title="Switch to green theme" aria-label="Switch to green theme"></button>
        </div>
    </div>

    <!-- Main Content Area -->
    <main class="container mx-auto px-4 py-8">
        <!-- Image Carousel -->
        <div id="carousel-container" class="relative w-full overflow-hidden rounded-lg shadow-lg mb-8">
            <div id="carousel-track" class="flex transition-transform duration-500 ease-in-out">
                <div class="w-full flex-shrink-0"><img src="https://placehold.co/1200x400/primary/ffffff?text=Great+Deals+on+New+Arrivals" alt="Banner 1" class="w-full object-cover rounded-lg"></div>
                <div class="w-full flex-shrink-0"><img src="https://placehold.co/1200x400/0f4c81/ffffff?text=Discover+Your+Next+Favorite+Book" alt="Banner 2" class="w-full object-cover rounded-lg"></div>
                <div class="w-full flex-shrink-0"><img src="https://placehold.co/1200x400/1a73e8/ffffff?text=Shop+International+Titles" alt="Banner 3" class="w-full object-cover rounded-lg"></div>
            </div>

            <!-- Carousel Nav Buttons -->
            <button id="prev-btn" class="absolute top-1/2 left-4 transform -translate-y-1/2 bg-gray-800 bg-opacity-50 text-white p-2 rounded-full hover:bg-opacity-75 transition-all focus:outline-none" aria-label="Previous slide" title="Previous slide">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
            </button>
            <button id="next-btn" class="absolute top-1/2 right-4 transform -translate-y-1/2 bg-gray-800 bg-opacity-50 text-white p-2 rounded-full hover:bg-opacity-75 transition-all focus:outline-none" aria-label="Next slide" title="Next slide">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
            </button>
        </div>

        <!-- Available Items Section -->
        <section id="items-display" class="p-6 bg-white rounded shadow-md mt-8">
            <h2 class="text-2xl font-bold mb-4">Available Items</h2>
            <div id="itemsContainer" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Items will be loaded here dynamically -->
            </div>
        </section>

        <!-- Our Products Section -->
        <section class="mb-8">
            <h2 class="text-2xl font-semibold mb-4">Our Products</h2>
            <div id="dynamicItemsContainer" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                <!-- Items will be loaded here dynamically -->
            </div>
        </section>

        <!-- Featured Arrivals Section -->
        <section class="mb-8">
            <h2 class="text-2xl font-semibold mb-4">Featured Arrivals</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                <!-- Book Item 1 -->
                <div class="bg-white rounded-lg shadow-md p-4 flex flex-col justify-between hover:shadow-xl transition-shadow">
                    <img src="https://placehold.co/200x300/e0e0e0/333333?text=Book+Cover+1" alt="Book Cover" class="w-full h-48 object-contain mb-4 rounded-md">
                    <div>
                        <h3 class="font-bold text-lg mb-1">The Great Adventure</h3>
                        <p class="text-gray-600 mb-2">By Jane Doe</p>
                        <div class="flex items-center space-x-2 mb-2">
                            <span class="text-sm line-through text-gray-500">LKR 1500.00</span>
                            <span class="text-xl font-bold text-primary transition-colors">LKR 1200.00</span>
                        </div>
                        <span class="bg-accent text-white text-xs font-semibold px-2 py-1 rounded-full transition-colors">-20%</span>
                    </div>
                    <div class="mt-4 flex space-x-2">
                        <button class="flex-1 bg-primary text-white py-2 rounded-md hover:bg-primary-light transition-colors quick-view-btn">Quick View</button>
                        <button class="flex-1 bg-gray-200 text-gray-700 py-2 rounded-md hover:bg-gray-300 transition-colors add-to-cart-btn">Add to Cart</button>
                    </div>
                </div>
                <!-- Book Item 2 -->
                <div class="bg-white rounded-lg shadow-md p-4 flex flex-col justify-between hover:shadow-xl transition-shadow">
                    <img src="https://placehold.co/200x300/d0d0d0/333333?text=Book+Cover+2" alt="Book Cover" class="w-full h-48 object-contain mb-4 rounded-md">
                    <div>
                        <h3 class="font-bold text-lg mb-1">Mystery of the Manor</h3>
                        <p class="text-gray-600 mb-2">By John Smith</p>
                        <div class="flex items-center space-x-2 mb-2">
                            <span class="text-sm line-through text-gray-500">LKR 1200.00</span>
                            <span class="text-xl font-bold text-primary transition-colors">LKR 1080.00</span>
                        </div>
                        <span class="bg-accent text-white text-xs font-semibold px-2 py-1 rounded-full transition-colors">-10%</span>
                    </div>
                    <div class="mt-4 flex space-x-2">
                        <button class="flex-1 bg-primary text-white py-2 rounded-md hover:bg-primary-light transition-colors quick-view-btn">Quick View</button>
                        <button class="flex-1 bg-gray-200 text-gray-700 py-2 rounded-md hover:bg-gray-300 transition-colors add-to-cart-btn">Add to Cart</button>
                    </div>
                </div>
                <!-- Book Item 3 -->
                <div class="bg-white rounded-lg shadow-md p-4 flex flex-col justify-between hover:shadow-xl transition-shadow">
                    <img src="https://placehold.co/200x300/c0c0c0/333333?text=Book+Cover+3" alt="Book Cover" class="w-full h-48 object-contain mb-4 rounded-md">
                    <div>
                        <h3 class="font-bold text-lg mb-1">The Coder's Guide</h3>
                        <p class="text-gray-600 mb-2">By Alex Chan</p>
                        <div class="flex items-center space-x-2 mb-2">
                            <span class="text-sm line-through text-gray-500">LKR 2000.00</span>
                            <span class="text-xl font-bold text-primary transition-colors">LKR 1800.00</span>
                        </div>
                        <span class="bg-accent text-white text-xs font-semibold px-2 py-1 rounded-full transition-colors">-10%</span>
                    </div>
                    <div class="mt-4 flex space-x-2">
                        <button class="flex-1 bg-primary text-white py-2 rounded-md hover:bg-primary-light transition-colors quick-view-btn">Quick View</button>
                        <button class="flex-1 bg-gray-200 text-gray-700 py-2 rounded-md hover:bg-gray-300 transition-colors add-to-cart-btn">Add to Cart</button>
                    </div>
                </div>
                <!-- Book Item 4 -->
                <div class="bg-white rounded-lg shadow-md p-4 flex flex-col justify-between hover:shadow-xl transition-shadow">
                    <img src="https://placehold.co/200x300/b0b0b0/333333?text=Book+Cover+4" alt="Book Cover" class="w-full h-48 object-contain mb-4 rounded-md">
                    <div>
                        <h3 class="font-bold text-lg mb-1">The Forgotten City</h3>
                        <p class="text-gray-600 mb-2">By Emily White</p>
                        <div class="flex items-center space-x-2 mb-2">
                            <span class="text-sm line-through text-gray-500">LKR 1800.00</span>
                            <span class="text-xl font-bold text-primary transition-colors">LKR 1620.00</span>
                        </div>
                        <span class="bg-accent text-white text-xs font-semibold px-2 py-1 rounded-full transition-colors">-10%</span>
                    </div>
                    <div class="mt-4 flex space-x-2">
                        <button class="flex-1 bg-primary text-white py-2 rounded-md hover:bg-primary-light transition-colors quick-view-btn">Quick View</button>
                        <button class="flex-1 bg-gray-200 text-gray-700 py-2 rounded-md hover:bg-gray-300 transition-colors add-to-cart-btn">Add to Cart</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Bestsellers Section -->
        <section>
            <h2 class="text-2xl font-semibold mb-4">Bestsellers</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                <!-- Book Item 5 -->
                <div class="bg-white rounded-lg shadow-md p-4 flex flex-col justify-between hover:shadow-xl transition-shadow">
                    <img src="https://placehold.co/200x300/a0a0a0/333333?text=Book+Cover+5" alt="Book Cover" class="w-full h-48 object-contain mb-4 rounded-md">
                    <div>
                        <h3 class="font-bold text-lg mb-1">World of Wonder</h3>
                        <p class="text-gray-600 mb-2">By Sarah Lee</p>
                        <div class="flex items-center space-x-2 mb-2">
                            <span class="text-sm line-through text-gray-500">LKR 1400.00</span>
                            <span class="text-xl font-bold text-primary transition-colors">LKR 1260.00</span>
                        </div>
                        <span class="bg-accent text-white text-xs font-semibold px-2 py-1 rounded-full transition-colors">-10%</span>
                    </div>
                    <div class="mt-4 flex space-x-2">
                        <button class="flex-1 bg-primary text-white py-2 rounded-md hover:bg-primary-light transition-colors quick-view-btn">Quick View</button>
                        <button class="flex-1 bg-gray-200 text-gray-700 py-2 rounded-md hover:bg-gray-300 transition-colors add-to-cart-btn">Add to Cart</button>
                    </div>
                </div>
                <!-- Book Item 6 -->
                <div class="bg-white rounded-lg shadow-md p-4 flex flex-col justify-between hover:shadow-xl transition-shadow">
                    <img src="https://placehold.co/200x300/909090/333333?text=Book+Cover+6" alt="Book Cover" class="w-full h-48 object-contain mb-4 rounded-md">
                    <div>
                        <h3 class="font-bold text-lg mb-1">The Last Guardian</h3>
                        <p class="text-gray-600 mb-2">By Mark Johnson</p>
                        <div class="flex items-center space-x-2 mb-2">
                            <span class="text-sm line-through text-gray-500">LKR 1900.00</span>
                            <span class="text-xl font-bold text-primary transition-colors">LKR 1710.00</span>
                        </div>
                        <span class="bg-accent text-white text-xs font-semibold px-2 py-1 rounded-full transition-colors">-10%</span>
                    </div>
                    <div class="mt-4 flex space-x-2">
                        <button class="flex-1 bg-primary text-white py-2 rounded-md hover:bg-primary-light transition-colors quick-view-btn">Quick View</button>
                        <button class="flex-1 bg-gray-200 text-gray-700 py-2 rounded-md hover:bg-gray-300 transition-colors add-to-cart-btn">Add to Cart</button>
                    </div>
                </div>
                <!-- Book Item 7 -->
                <div class="bg-white rounded-lg shadow-md p-4 flex flex-col justify-between hover:shadow-xl transition-shadow">
                    <img src="https://placehold.co/200x300/808080/333333?text=Book+Cover+7" alt="Book Cover" class="w-full h-48 object-contain mb-4 rounded-md">
                    <div>
                        <h3 class="font-bold text-lg mb-1">Beyond the Stars</h3>
                        <p class="text-gray-600 mb-2">By David Chen</p>
                        <div class="flex items-center space-x-2 mb-2">
                            <span class="text-sm line-through text-gray-500">LKR 2100.00</span>
                            <span class="text-xl font-bold text-primary transition-colors">LKR 1890.00</span>
                        </div>
                        <span class="bg-accent text-white text-xs font-semibold px-2 py-1 rounded-full transition-colors">-10%</span>
                    </div>
                    <div class="mt-4 flex space-x-2">
                        <button class="flex-1 bg-primary text-white py-2 rounded-md hover:bg-primary-light transition-colors quick-view-btn">Quick View</button>
                        <button class="flex-1 bg-gray-200 text-gray-700 py-2 rounded-md hover:bg-gray-300 transition-colors add-to-cart-btn">Add to Cart</button>
                    </div>
                </div>
                <!-- Book Item 8 -->
                <div class="bg-white rounded-lg shadow-md p-4 flex flex-col justify-between hover:shadow-xl transition-shadow">
                    <img src="https://placehold.co/200x300/707070/333333?text=Book+Cover+8" alt="Book Cover" class="w-full h-48 object-contain mb-4 rounded-md">
                    <div>
                        <h3 class="font-bold text-lg mb-1">Echoes of the Past</h3>
                        <p class="text-gray-600 mb-2">By Olivia Green</p>
                        <div class="flex items-center space-x-2 mb-2">
                            <span class="text-sm line-through text-gray-500">LKR 1650.00</span>
                            <span class="text-xl font-bold text-primary transition-colors">LKR 1485.00</span>
                        </div>
                        <span class="bg-accent text-white text-xs font-semibold px-2 py-1 rounded-full transition-colors">-10%</span>
                    </div>
                    <div class="mt-4 flex space-x-2">
                        <button class="flex-1 bg-primary text-white py-2 rounded-md hover:bg-primary-light transition-colors quick-view-btn">Quick View</button>
                        <button class="flex-1 bg-gray-200 text-gray-700 py-2 rounded-md hover:bg-gray-300 transition-colors add-to-cart-btn">Add to Cart</button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-8">
        <div class="container mx-auto px-4 text-center">
            <p>&copy; 2024 Pahana Edu Bookshop. All rights reserved.</p>
        </div>
    </footer>

    <!-- Modal for messages -->
    <div id="message-modal" class="fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center hidden">
        <div class="bg-white p-6 rounded-lg shadow-xl text-center">
            <p id="modal-message" class="text-lg font-semibold mb-4"></p>
            <button id="close-modal-btn" class="bg-primary text-white py-2 px-4 rounded-md hover:bg-primary-light transition-colors">Close</button>
        </div>
    </div>
</div>

<!-- Cart Sidebar -->
<div id="cart-sidebar" class="fixed top-0 right-0 h-full w-80 bg-white shadow-lg transform translate-x-full transition-transform z-50" aria-hidden="true" aria-label="Shopping Cart">
    <div class="p-4 flex justify-between items-center border-b">
        <h2 class="text-xl font-bold">Your Cart</h2>
        <button id="close-cart" aria-label="Close Cart" class="text-gray-600 hover:text-gray-900 focus:outline-none text-2xl font-bold leading-none">&times;</button>
    </div>
    <div id="cart-items" class="p-4 overflow-y-auto h-[calc(100%-96px)]">
        <p class="text-gray-600">Your cart is empty.</p>
    </div>
    <div class="p-4 border-t">
        <button id="checkout-btn" class="w-full bg-primary text-white py-2 rounded hover:bg-primary-light transition-colors" disabled>Proceed to Checkout</button>
    </div>
</div>


<script>
    // Mobile menu toggle
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    mobileMenuBtn.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
    });

    // Image Carousel functionality
    const carouselTrack = document.getElementById('carousel-track');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    let currentIndex = 0;
    const items = carouselTrack.children;

    function updateCarousel() {
        carouselTrack.style.transform = `translateX(-${currentIndex * 100}%)`;
    }

    nextBtn.addEventListener('click', () => {
        currentIndex = (currentIndex + 1) % items.length;
        updateCarousel();
    });

    prevBtn.addEventListener('click', () => {
        currentIndex = (currentIndex - 1 + items.length) % items.length;
        updateCarousel();
    });

    setInterval(() => {
        currentIndex = (currentIndex + 1) % items.length;
        updateCarousel();
    }, 5000);

    // Modal for messages
    const modal = document.getElementById('message-modal');
    const modalMessage = document.getElementById('modal-message');
    const closeModalBtn = document.getElementById('close-modal-btn');

    function showMessage(message) {
        modalMessage.textContent = message;
        modal.classList.remove('hidden');
    }

    closeModalBtn.addEventListener('click', () => {
        modal.classList.add('hidden');
    });

    // Logout function
    function logout() {
        fetch("/logout", { method: "POST" })
            .then(() => {
                window.location.href = "/index.html";
            })
            .catch(error => {
                showMessage(`Error logging out: ${error.message}`);
            });
    }

    // Cart functionality
    let cart = []; // Initialize cart array

    const cartButton = document.getElementById('cart-button');
    const cartSidebar = document.getElementById('cart-sidebar');
    const closeCartBtn = document.getElementById('close-cart');
    const cartItemsContainer = document.getElementById('cart-items');
    const cartCount = document.getElementById('cart-count');
    const checkoutBtn = document.getElementById('checkout-btn');

    // Open cart sidebar
    cartButton.addEventListener('click', () => {
        cartSidebar.classList.remove('translate-x-full');
        cartSidebar.setAttribute('aria-hidden', 'false');
    });

    // Close cart sidebar
    closeCartBtn.addEventListener('click', () => {
        cartSidebar.classList.add('translate-x-full');
        cartSidebar.setAttribute('aria-hidden', 'true');
    });

    // Update cart UI
    function updateCartUI() {
        cartCount.textContent = cart.length; // Update cart item count badge
        if (cart.length === 0) {
            cartItemsContainer.innerHTML = '<p class="text-gray-600">Your cart is empty.</p>';
            checkoutBtn.disabled = true;
        } else {
            checkoutBtn.disabled = false;
            cartItemsContainer.innerHTML = ''; // Clear existing items
            cart.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'flex justify-between items-center mb-4 border-b pb-2';
                itemDiv.innerHTML = `
                    <div>
                        <p class="font-semibold">${item.name}</p>
                        <p class="text-sm text-gray-600">LKR ${item.price.toFixed(2)} x ${item.quantity}</p>
                    </div>
                    <button aria-label="Remove ${item.name} from cart" class="text-red-600 hover:text-red-800 font-bold" data-index="${index}">&times;</button>
                `;
                cartItemsContainer.appendChild(itemDiv);
            });

            // Add event listeners for remove buttons
            cartItemsContainer.querySelectorAll('button').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const idx = parseInt(e.target.getAttribute('data-index'));
                    if (!isNaN(idx)) {
                        cart.splice(idx, 1); // Remove item from cart array
                        updateCartUI(); // Re-render cart
                    }
                });
            });
        }
    }

    // Add item to cart function
    function addToCart(item) {
        const existingItem = cart.find(i => i.id === item.id);
        if (existingItem) {
            existingItem.quantity += 1;
        } else {
            cart.push({...item, quantity: 1});
        }
        updateCartUI(); // Update UI after adding item
        showMessage(`Added "${item.name}" to your cart!`); // Show confirmation message
    }

    // Checkout button click handler
    checkoutBtn.addEventListener('click', () => {
        window.location.href = '/checkout.html'; // Adjust path as needed
    });

    // Add to Cart buttons setup (for dynamically loaded items and static items)
    function setupAddToCartButtons() {
        document.querySelectorAll('.add-to-cart-btn').forEach(button => {
            button.addEventListener('click', () => {
                const card = button.closest('.bg-white, .border'); // Find the parent product card
                const name = card.querySelector('h3').textContent;
                const priceText = card.querySelector('.text-xl.font-bold.text-primary, .font-bold.text-primary')?.textContent || '';
                const price = parseFloat(priceText.replace(/[^\d.]/g, '')) || 0;

                // You might want to get a unique ID from a data attribute on the button or card
                const itemId = button.dataset.itemId || name.toLowerCase().replace(/\s+/g, '-');

                const item = {
                    id: itemId,
                    name: name,
                    price: price
                };
                addToCart(item);
            });
        });
    }

    // Quick View buttons setup
    function setupQuickViewButtons() {
        const quickViewButtons = document.querySelectorAll('.quick-view-btn');
        quickViewButtons.forEach(button => {
            button.addEventListener('click', () => {
                const bookTitle = button.closest('.bg-white').querySelector('h3').textContent;
                showMessage(`Quick View for "${bookTitle}" is not implemented yet.`);
            });
        });
    }

    // Load items for Available Items section
    async function loadItems() {
        try {
            const response = await fetch('/api/items', {
                credentials: 'include'
            });
            if (!response.ok) throw new Error(`Failed to fetch items: ${response.status} ${response.statusText}`);

            const items = await response.json();
            const container = document.getElementById('itemsContainer');
            container.innerHTML = '';

            if (items.length === 0) {
                container.innerHTML = '<p class="text-gray-600 text-center col-span-full">No items available yet.</p>';
                return;
            }

            items.forEach(item => {
                const card = document.createElement('div');
                card.className = 'border rounded p-4 shadow hover:shadow-lg transition';

                card.innerHTML = `
                    <img src="${item.imageUrl || 'https://via.placeholder.com/150'}" alt="${item.name}" class="w-full h-40 object-cover mb-4 rounded" />
                    <h3 class="font-bold text-lg mb-1">${item.name}</h3>
                    <p class="text-gray-700 mb-2">${item.author || ''}</p>
                    <p class="font-bold text-primary">LKR ${item.price.toFixed(2)}</p>
                    <div class="mt-4 flex space-x-2">
                        <button class="flex-1 bg-primary text-white py-2 rounded-md hover:bg-primary-light transition-colors quick-view-btn" data-item-id="${item.id}">Quick View</button>
                        <button class="flex-1 bg-gray-200 text-gray-700 py-2 rounded-md hover:bg-gray-300 transition-colors add-to-cart-btn" data-item-id="${item.id}" data-item-price="${item.price}">Add to Cart</button>
                    </div>
                `;
                container.appendChild(card);
            });
            setupAddToCartButtons(); // Re-attach event listeners for newly loaded items
            setupQuickViewButtons();
        } catch (error) {
            console.error('Error loading items:', error);
            document.getElementById('itemsContainer').innerHTML = '<p class="text-red-500 text-center col-span-full">Failed to load items. Please try again later.</p>';
        }
    }

    // Load banners from shared data or API
    async function loadBanners() {
        try {
            // First check if there's a banner in shared data
            if (window.sharedData && window.sharedData.banner) {
                console.log('Loading banner from shared data');
                updateCarouselWithBanner(window.sharedData.banner);
                return;
            }

            // Fallback to API if no shared data
            const response = await fetch('/api/banner', {
                credentials: 'include'
            });
            if (response.ok) {
                const result = await response.json();
                console.log('Loading banner from API:', result.imageUrl);
                updateCarouselWithBanner(result.imageUrl);
            } else {
                console.log('No banner found in API, using default banners');
                // Keep default banners if no API banner
            }
        } catch (error) {
            console.error('Error loading banners:', error);
            // Keep default banners on error
        }
    }

    // Update carousel with a specific banner
    function updateCarouselWithBanner(bannerUrl) {
        const carouselTrack = document.getElementById('carousel-track');
        
        // Find the specific banner image to replace (Banner 3 with "Shop International Titles")
        const bannerImages = carouselTrack.querySelectorAll('img');
        let targetImage = null;
        
        // Look for the specific banner image
        bannerImages.forEach(img => {
            if (img.src.includes('Shop+International+Titles') || img.alt === 'Banner 3') {
                targetImage = img;
            }
        });
        
        if (targetImage) {
            // Replace the specific banner image
            console.log('Replacing Banner 3 with uploaded image');
            targetImage.src = bannerUrl;
            targetImage.alt = 'Uploaded Banner';
        } else {
            // Fallback: if the specific image is not found, replace the third banner
            const bannerDivs = carouselTrack.querySelectorAll('.w-full.flex-shrink-0');
            if (bannerDivs.length >= 3) {
                console.log('Replacing third banner with uploaded image');
                const thirdBanner = bannerDivs[2];
                const img = thirdBanner.querySelector('img');
                if (img) {
                    img.src = bannerUrl;
                    img.alt = 'Uploaded Banner';
                }
            } else {
                // Last resort: clear and add new banner
                console.log('Adding new banner to carousel');
                carouselTrack.innerHTML = '';
                const bannerDiv = document.createElement('div');
                bannerDiv.className = 'w-full flex-shrink-0';
                bannerDiv.innerHTML = `<img src="${bannerUrl}" alt="Uploaded Banner" class="w-full object-cover rounded-lg">`;
                carouselTrack.appendChild(bannerDiv);
                
                // Reset carousel to first slide
                currentIndex = 0;
                updateCarousel();
            }
        }
        
        // Ensure navigation buttons are visible (since we're keeping multiple banners)
        document.getElementById('prev-btn').style.display = 'block';
        document.getElementById('next-btn').style.display = 'block';
    }

    // Function to restore original banner (for testing purposes)
    function restoreOriginalBanner() {
        const carouselTrack = document.getElementById('carousel-track');
        const bannerImages = carouselTrack.querySelectorAll('img');
        
        bannerImages.forEach(img => {
            if (img.alt === 'Uploaded Banner') {
                img.src = 'https://placehold.co/1200x400/1a73e8/ffffff?text=Shop+International+Titles';
                img.alt = 'Banner 3';
                console.log('Restored original Banner 3');
            }
        });
    }

    // Load items for Our Products section
    async function loadDynamicItems() {
        try {
            const response = await fetch('/api/items', {
                credentials: 'include'
            });
            if (!response.ok) throw new Error(`Failed to fetch items: ${response.status} ${response.statusText}`);

            const items = await response.json();
            const container = document.getElementById('dynamicItemsContainer');
            container.innerHTML = '';

            if (items.length === 0) {
                container.innerHTML = '<p class="text-gray-600 text-center col-span-full">No items available yet. Check back later!</p>';
                return;
            }

            items.forEach(item => {
                const card = document.createElement('div');
                card.className = 'bg-white rounded-lg shadow-md p-4 flex flex-col justify-between hover:shadow-xl transition-shadow';

                card.innerHTML = `
                    <img src="${item.imageUrl || 'https://via.placeholder.com/200x300?text=No+Image'}" alt="${item.name}" class="w-full h-48 object-contain mb-4 rounded-md" />
                    <div>
                        <h3 class="font-bold text-lg mb-1">${item.name}</h3>
                        <p class="text-gray-600 mb-2">Stock: ${item.stock}</p>
                        <div class="flex items-center space-x-2 mb-2">
                            <span class="text-xl font-bold text-primary transition-colors">LKR ${parseFloat(item.price).toFixed(2)}</span>
                        </div>
                    </div>
                    <div class="mt-4 flex space-x-2">
                        <button class="flex-1 bg-primary text-white py-2 rounded-md hover:bg-primary-light transition-colors quick-view-btn" data-item-id="${item.id}">Quick View</button>
                        <button class="flex-1 bg-gray-200 text-gray-700 py-2 rounded-md hover:bg-gray-300 transition-colors add-to-cart-btn" data-item-id="${item.id}" data-item-price="${item.price}">Add to Cart</button>
                    </div>
                `;
                container.appendChild(card);
            });

            setupAddToCartButtons(); // Re-attach event listeners for newly loaded items
            setupQuickViewButtons();
        } catch (error) {
            console.error('Error loading dynamic items:', error);
            document.getElementById('dynamicItemsContainer').innerHTML = '<p class="text-red-500 text-center col-span-full">Failed to load items. Please try again later.</p>';
        }
    }

    // Refresh data periodically to sync with admin changes
    function startPeriodicRefresh() {
        // Refresh every 30 seconds
        setInterval(() => {
            loadBanners();
            loadItems();
            loadDynamicItems();
        }, 30000);
    }

    // Manual refresh function
    function refreshContent() {
        loadBanners();
        loadItems();
        loadDynamicItems();
        showMessage('Content refreshed successfully!');
    }

    // Initialize shared data storage
    if (!window.sharedData) {
        window.sharedData = {
            items: [],
            banner: null,
            lastUpdated: null
        };
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', () => {
        loadBanners();
        loadItems();
        loadDynamicItems();
        startPeriodicRefresh();
        // The listenForSharedDataChanges function was incomplete and causing errors.
        // If you intend to use sharedData for real-time updates, ensure the implementation is complete.
        // For now, I'm commenting it out to resolve the syntax errors.
        // listenForSharedDataChanges();
        
        // Add refresh button event listener
        document.getElementById('refresh-btn').addEventListener('click', refreshContent);
        
        // Add reset banner button event listener
        document.getElementById('reset-banner-btn').addEventListener('click', () => {
            restoreOriginalBanner();
            showMessage('Banner reset to original!');
        });

        // Theme switching logic
        const themeBlueBtn = document.getElementById('theme-blue-btn');
        const themeGreenBtn = document.getElementById('theme-green-btn');
        const body = document.body;

        themeBlueBtn.addEventListener('click', () => {
            body.classList.remove('theme-green');
            localStorage.setItem('theme', 'blue');
        });

        themeGreenBtn.addEventListener('click', () => {
            body.classList.add('theme-green');
            localStorage.setItem('theme', 'green');
        });

        // Apply saved theme on load
        if (localStorage.getItem('theme') === 'green') {
            body.classList.add('theme-green');
        }

        // Initial update of cart UI on page load
        updateCartUI();
        setupAddToCartButtons(); // Ensure buttons are set up for static content too
        setupQuickViewButtons();
    });

    // The listenForSharedDataChanges function was incomplete and causing errors.
    // If you intend to use sharedData for real-time updates, ensure the implementation is complete.
    // For now, I'm commenting it out to resolve the syntax errors.
    /*
    function listenForSharedDataChanges() {
        // Check for shared data changes every 2 seconds
        setInterval(() => {
            if (window.sharedData && window.sharedData.lastUpdated) {
                const lastCheck = localStorage.getItem('lastDataUpdate');
                if (!lastCheck || window.sharedData.lastUpdated > parseInt(lastCheck)) {
                    console.log('Data updated, refreshing display');
                    
                    // Update banner if changed
                    if (window.sharedData.banner) {
                        updateCarouselWithBanner(window.sharedData.banner);
                    }
                    
                    // Update items if changed
                    if (window.sharedData.items && window.sharedData.items.length > 0) {
                        updateItemsFromSharedData(window.sharedData.items);
                    }
                    
                    localStorage.setItem('lastDataUpdate', window.sharedData.lastUpdated.toString());
                }
            }
        }, 2000);
    }

    // Update items from shared data
    function updateItemsFromSharedData(sharedItems) {
        // Update Available Items section
        const container = document.getElementById('itemsContainer');
        container.innerHTML = '';
        
        if (sharedItems.length === 0) {
            container.innerHTML = '<p class="text-gray-600 text-center col-span-full">No items available yet.</p>';
            return;
        }

        sharedItems.forEach(item => {
            const card = document.createElement('div');
            card.className = 'border rounded p-4 shadow hover:shadow-lg transition';

            card.innerHTML = `
                <img src="${item.image || 'https://via.placeholder.com/150'}" alt="${item.name}" class="w-full h-40 object-cover mb-4 rounded" />
                <h3 class="font-bold text-lg mb-1">${item.name}</h3>
                <p class="text-gray-700 mb-2">${item.author || ''}</p>
                <p class="font-bold text-primary">LKR ${item.price.toFixed(2)}</p>
            `;
            container.appendChild(card);
        });

        // Update Our Products section
        const dynamicContainer = document.getElementById('dynamicItemsContainer');
        dynamicContainer.innerHTML = '';

        if (sharedItems.length === 0) {
            dynamicContainer.innerHTML = '<p class="text-gray-600 text-center col-span-full">No items available yet. Check back later!</p>';
            return;
        }

        sharedItems.forEach(item => {
            const card = document.createElement('div');
            card.className = 'bg-white rounded-lg shadow-md p-4 flex flex-col justify-between hover:shadow-xl transition-shadow';

            card.innerHTML = `
                <img src="${item.image || 'https://via.placeholder.com/200x300?text=No+Image'}" alt="${item.name}" class="w-full h-48 object-contain mb-4 rounded-md" />
                <div>
                    <h3 class="font-bold text-lg mb-1">${item.name}</h3>
                    <p class="text-gray-600 mb-2">Stock: ${item.stock}</p>
                    <div class="flex items-center space-x-2 mb-2">
                        <span class="text-xl font-bold text-primary transition-colors">LKR ${parseFloat(item.price).toFixed(2)}</span>
                    </div>
                </div>
                <div class="mt-4 flex space-x-2">
                    <button class="flex-1 bg-primary text-white py-2 rounded-md hover:bg-primary-light transition-colors quick-view-btn" data-item-id="${item.id}">Quick View</button>
                    <button class="flex-1 bg-gray-200 text-gray-700 py-2 rounded-md hover:bg-gray-300 transition-colors add-to-cart-btn" data-item-id="${item.id}" data-item-price="${item.price}">Add to Cart</button>
                </div>
            `;
            dynamicContainer.appendChild(card);
        });

        setupAddToCartButtons();
        setupQuickViewButtons();
    }
    */
</script>
</body>
</html>
